import { TreeNode, TextTreeNode, ParentAwareTreeNode, PathExpressionEngine } from "../tree/PathExpression"
import * as treeHelper from "../tree/TreeHelper"

import { File } from "../model/Core"

/**
 * Superclass for working with ASTs
 */
export class AstHelper {

    public constructor(public pexe: PathExpressionEngine) {}

    /**
     * Reparse this file, given the type and return the top level node.
     */
    protected reparseNodeUnderFile(languageNode: TextTreeNode, type: String): TextTreeNode {
        let f = treeHelper.findAncestorWithTag<File>(languageNode, "File")
        if (f) {
            let pathExpression = `/${type}()`
            let r = this.pexe.scalar<File,TextTreeNode>(f, pathExpression)
            //console.log(`Reparsed=${r}`)
            return r
        }
        else {
            throw new Error(`Cannot find File parent`)
        }
    }
}