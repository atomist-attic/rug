import {Addressed,TreeNode,TextTreeNode,ParentAwareTreeNode} from "./PathExpression"

/**
 * Convenient mutable superclass for node implementations that
 * should be address aware
 */
export abstract class AddressedNodeSupport implements Addressed {

    private _navigatedFrom: Addressed = null
    private _step: string

    address() {
        return this._navigatedFrom ?
            this._navigatedFrom.address() + this._step :
            ""
    }

    /**
     * We got to here from the given node, via the given step.
     * Still works even if the address of the node changes,
     * as it may during building in test
     */
    navigatedFrom(navigatedFrom: Addressed, step: string) {
        if (navigatedFrom == this)
            throw new Error(`Illegal cycle at ${this}`)
        this._navigatedFrom = navigatedFrom
        this._step = step
    }
    
}