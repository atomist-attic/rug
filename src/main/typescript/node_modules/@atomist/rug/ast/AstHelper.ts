import {TreeNode,TextTreeNode,ParentAwareTreeNode,PathExpressionEngine} from "../tree/PathExpression"
import {TreeHelper} from "../tree/TreeHelper"

import {File} from "../model/Core"

/**
 * Superclass for working with ASTs
 */
export class AstHelper {

    public constructor(public pexe: PathExpressionEngine) {}

    protected treeHelper = new TreeHelper()

    /**
     * Reparse this file, given the type and return the top level node.
     */
    protected reparseNodeUnderFile(languageNode: TextTreeNode, type: String): TextTreeNode {
        let f = this.treeHelper.findAncestorWithTag<File>(languageNode, "File")
        if (f) {
            let pathExpression = `/${type}()`
            let r = this.pexe.scalarStr<File,TextTreeNode>(f, pathExpression)
            //console.log(`Reparsed=${r}`)
            return r
        }
        else {
            throw new Error(`Cannot find File parent`)
        }
    }
}